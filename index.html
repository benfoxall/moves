<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>js move</title>
    <style media="screen">
      body{margin: 0}
    </style>
  </head>
  <body>
    <script src="store.js"></script>
    <script type="text/javascript">

    var store = new TimeStore(2);

    // interpolate colours
    function c(i, l){
      var h = (1-Math.min(1,Math.max(0, i))) * 130;
      return 'hsl('+ h +', 100%, ' + (l || 50) + '%)'
    }

    function rect(b){
      return [b[0][0], b[1][0], b[0][1] - b[0][0], b[1][1] - b[1][0]]
    }

    var canvas = document.createElement('canvas');
    document.body.appendChild(canvas);

    function resize(){
      canvas.width  = window.innerWidth;
      canvas.height = window.innerHeight;
    }
    resize();
    window.addEventListener('resize', resize);


    var ctx = canvas.getContext('2d');

    function render(){
      requestAnimationFrame(render);

      var b = store.extent(1000);
      var distance = store.distance(1000) / 500;

      ctx.fillStyle = c(distance, 80);
      ctx.fillRect(0,0,canvas.width,canvas.height);

      ctx.fillStyle = c(distance);
      if(b[0])
        ctx.fillRect.apply(ctx, rect(b));

      ctx.strokeStyle = '#fff';
      ctx.lineWidth = 2;

      ctx.beginPath();
      store.each(1000, function(x, y) {
          ctx.lineTo(x, y);
          ctx.arc(x,y,2,0,2*Math.PI);
          ctx.moveTo(x, y);
      })
      ctx.stroke();

    }

    render();

    canvas.addEventListener('mousemove', function(e){
      store.add(e.offsetX, e.offsetY);
    }, false);

    canvas.addEventListener('touchmove', function(e){
      e.preventDefault()
      for (var i = 0; i < e.touches.length; i++) {
        store.add(e.touches[i].pageX, e.touches[i].pageY);
      }
    })

    </script>
  </body>
</html>
